// src/lib/diazed_d2d3d4_35a.ts
// DIAZED D2/D3/D4 35 A – hårdkodede punkter fra Engauge (Ik [A], t [s])

export type DiazedPoint = {
  ik: number;
  t: number;
};

export const DIAZED_D2D3D4_35A_POINTS: DiazedPoint[] = [
  { ik: 49.966, t: 3567.5 },
  { ik: 51.194, t: 3038.5 },
  { ik: 52.275, t: 2706.4 },
  { ik: 53.132, t: 2366.3 },
  { ik: 54.231, t: 2037.6 },
  { ik: 55.399, t: 1664.3 },
  { ik: 57.096, t: 1382.9 },
  { ik: 58.859, t: 1163.8 },
  { ik: 60.508, t: 890.7 },
  { ik: 61.679, t: 782.7 },
  { ik: 63.091, t: 635.2 },
  { ik: 64.722, t: 542.7 },
  { ik: 66.165, t: 447 },
  { ik: 67.798, t: 369.51 },
  { ik: 69.552, t: 323.08 },
  { ik: 71.021, t: 274.74 },
  { ik: 72.017, t: 246.98 },
  { ik: 73.708, t: 207.13 },
  { ik: 75.252, t: 175.77 },
  { ik: 76.498, t: 151.88 },
  { ik: 78.113, t: 132.18 },
  { ik: 80.725, t: 100.39 },
  { ik: 82.397, t: 84.35 },
  { ik: 84.529, t: 69.44 },
  { ik: 86.31,  t: 61.28 },
  { ik: 89.37,  t: 50.92 },
  { ik: 91.26,  t: 42.903 },
  { ik: 93.19,  t: 37.511 },
  { ik: 95.37,  t: 31.752 },
  { ik: 98.07,  t: 26.628 },
  { ik: 99.91,  t: 23.068 },
  { ik: 103.21, t: 20.535 },
  { ik: 105.39, t: 17.964 },
  { ik: 107.36, t: 15.562 },
  { ik: 110.14, t: 13.233 },
  { ik: 114.67, t: 12.006 },
  { ik: 117.81, t: 10.163 },
  { ik: 121.14, t: 8.764 },
  { ik: 125.14, t: 7.662 },
  { ik: 128.9,  t: 7.019 },
  { ik: 130.78, t: 6.164 },
  { ik: 135.42, t: 5.439 },
  { ik: 140.54, t: 4.734 },
  { ik: 144.9,  t: 4.1037 },
  { ik: 147.57, t: 3.6695 },
  { ik: 152.44, t: 3.2084 },
  { ik: 156.02, t: 2.8709 },
  { ik: 161.18, t: 2.5809 },
  { ik: 164.8,  t: 2.3992 },
  { ik: 170.02, t: 2.0192 },
  { ik: 176.04, t: 1.7251 },
  { ik: 180.17, t: 1.5871 },
  { ik: 187.44, t: 1.4358 },
  { ik: 190.5,  t: 1.2591 },
  { ik: 197.25, t: 1.1214 },
  { ik: 203.44, t: 1.0117 },
  { ik: 208.55, t: 0.9021 },
  { ik: 214.44, t: 0.811 },
  { ik: 220.5,  t: 0.7392 },
  { ik: 225.68, t: 0.6707 },
  { ik: 234.1,  t: 0.6055 },
  { ik: 240.28, t: 0.5321 },
  { ik: 247.07, t: 0.4739 },
  { ik: 252.87, t: 0.436 },
  { ik: 259.41, t: 0.39931 },
  { ik: 269.39, t: 0.36234 },
  { ik: 274.28, t: 0.3227 },
  { ik: 278.77, t: 0.30526 },
  { ik: 286.65, t: 0.27569 },
  { ik: 294.74, t: 0.25014 },
  { ik: 306.39, t: 0.21684 },
  { ik: 313.81, t: 0.19753 },
  { ik: 320.44, t: 0.18173 },
  { ik: 329.49, t: 0.16413 },
  { ik: 340.37, t: 0.14686 },
  { ik: 352.57, t: 0.12977 },
  { ik: 359.04, t: 0.11869 },
  { ik: 368.33, t: 0.1062 },
  { ik: 380.5,  t: 0.09771 },
  { ik: 389.43, t: 0.08948 },
  { ik: 405.72, t: 0.07766 },
  { ik: 415.59, t: 0.07001 },
  { ik: 428.32, t: 0.06149 },
  { ik: 443.5,  t: 0.05377 },
  { ik: 453.92, t: 0.04993 },
  { ik: 466.87, t: 0.04648 },
  { ik: 479.93, t: 0.039425 },
  { ik: 492.34, t: 0.036272 },
  { ik: 509.79, t: 0.032158 },
  { ik: 531.0,  t: 0.027814 },
  { ik: 544.03, t: 0.025394 },
  { ik: 558.1,  t: 0.022934 },
  { ik: 571.21, t: 0.021002 },
  { ik: 592.83, t: 0.018793 },
  { ik: 611.04, t: 0.016645 },
  { ik: 622.45, t: 0.014978 },
  { ik: 637.06, t: 0.013653 },
  { ik: 655.06, t: 0.012446 },
  { ik: 675.13, t: 0.011292 },
  { ik: 687.79, t: 0.010294 },
  { ik: 703.14, t: 0.009961 },
  { ik: 718.81, t: 0.009 },
  { ik: 744.28, t: 0.008128 },
  { ik: 760.0,  t: 0.007307 },
  { ik: 783.28, t: 0.006448 },
  { ik: 809.13, t: 0.005824 },
  { ik: 832.02, t: 0.005235 },
  { ik: 853.5,  t: 0.004728 },
  { ik: 873.6,  t: 0.0042902 },
  { ik: 883.8,  t: 0.004115 },
];

// Log-log interpolation
function interpolateDiazed(points: DiazedPoint[], ik: number): number | null {
  if (!points.length || ik <= 0 || !Number.isFinite(ik)) return null;

  const sorted = [...points].sort((a, b) => a.ik - b.ik);

  if (ik <= sorted[0].ik) return sorted[0].t;
  if (ik >= sorted[sorted.length - 1].ik) return sorted[sorted.length - 1].t;

  for (let i = 0; i < sorted.length - 1; i++) {
    const p1 = sorted[i];
    const p2 = sorted[i + 1];

    if (ik >= p1.ik && ik <= p2.ik) {
      const logI1 = Math.log10(p1.ik);
      const logI2 = Math.log10(p2.ik);
      const logT1 = Math.log10(p1.t);
      const logT2 = Math.log10(p2.t);
      const logIk = Math.log10(ik);

      const ratio = (logIk - logI1) / (logI2 - logI1);
      const logT = logT1 + (logT2 - logT1) * ratio;

      return 10 ** logT;
    }
  }

  return null;
}

// Offentlig funktion til resten af programmet
export function getDiazedD2D3D4_35ATripTime(ik: number): number | null {
  return interpolateDiazed(DIAZED_D2D3D4_35A_POINTS, ik);
}
