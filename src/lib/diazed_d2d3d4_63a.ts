// src/lib/diazed_d2d3d4_63a.ts
// DIAZED D2/D3/D4 63 A – hårdkodede punkter fra Engauge (Ik [A], t [s])
// Kilde: fuld fil fra bruger :contentReference[oaicite:1]{index=1}

export type DiazedPoint = {
  ik: number;
  t: number;
};

export const DIAZED_D2D3D4_63A_POINTS: DiazedPoint[] = [
  { ik: 90.74, t: 3567.5 },
  { ik: 92.32, t: 3066.8 },
  { ik: 93.62, t: 2757 },
  { ik: 96.04, t: 2478.4 },
  { ik: 99.65, t: 2037.6 },
  { ik: 102.25, t: 1703.3 },
  { ik: 104.66, t: 1421.8 },
  { ik: 107.86, t: 1248.9 },
  { ik: 109.43, t: 1163.8 },
  { ik: 112.99, t: 932.9 },
  { ik: 114.31, t: 838.7 },
  { ik: 117.38, t: 729.8 },
  { ik: 119.46, t: 650.1 },
  { ik: 122.84, t: 560.6 },
  { ik: 125.14, t: 481.1 },
  { ik: 128.9, t: 416.8 },
  { ik: 132.0, t: 359.39 },
  { ik: 134.17, t: 314.23 },
  { ik: 137.96, t: 273.47 },
  { ik: 139.9, t: 238.06 },
  { ik: 143.84, t: 208.09 },
  { ik: 146.54, t: 180.27 },
  { ik: 149.98, t: 153.29 },
  { ik: 153.63, t: 139.18 },
  { ik: 156.38, t: 117.19 },
  { ik: 160.43, t: 99.65 },
  { ik: 164.58, t: 87.94 },
  { ik: 168.7, t: 79.49 },
  { ik: 172.0, t: 66.61 },
  { ik: 176.45, t: 55.6 },
  { ik: 183.1, t: 45.4 },
  { ik: 187.71, t: 40.051 },
  { ik: 192.16, t: 35.954 },
  { ik: 197.86, t: 31.439 },
  { ik: 204.03, t: 26.857 },
  { ik: 208.25, t: 23.622 },
  { ik: 213.81, t: 21.642 },
  { ik: 219.51, t: 19.035 },
  { ik: 224.71, t: 17.138 },
  { ik: 230.37, t: 15.565 },
  { ik: 236.86, t: 14.136 },
  { ik: 239.64, t: 12.952 },
  { ik: 246.4, t: 11.525 },
  { ik: 253.71, t: 10.078 },
  { ik: 258.96, t: 9.234 },
  { ik: 266.25, t: 8.265 },
  { ik: 271.97, t: 7.526 },
  { ik: 277.03, t: 6.916 },
  { ik: 283.75, t: 6.309 },
  { ik: 291.7, t: 5.588 },
  { ik: 296.58, t: 5.192 },
  { ik: 302.82, t: 4.832 },
  { ik: 311.13, t: 4.2732 },
  { ik: 317.5, t: 3.8553 },
  { ik: 328.21, t: 3.415 },
  { ik: 336.17, t: 3.1613 },
  { ik: 344.42, t: 2.8917 },
  { ik: 349.43, t: 2.5827 },
  { ik: 358.56, t: 2.3216 },
  { ik: 365.9, t: 2.1178 },
  { ik: 372.71, t: 1.9895 },
  { ik: 380.34, t: 1.8215 },
  { ik: 391.72, t: 1.6906 },
  { ik: 402.7, t: 1.4991 },
  { ik: 409.43, t: 1.3776 },
  { ik: 421.68, t: 1.2429 },
  { ik: 429.52, t: 1.1421 },
  { ik: 445.53, t: 1.0117 },
  { ik: 458.14, t: 0.9128 },
  { ik: 473.59, t: 0.7909 },
  { ik: 487.76, t: 0.6903 },
  { ik: 506.72, t: 0.6055 },
  { ik: 513.58, t: 0.5517 },
  { ik: 528.95, t: 0.5126 },
  { ik: 540.78, t: 0.4641 },
  { ik: 554.91, t: 0.40663 },
  { ik: 564.19, t: 0.37642 },
  { ik: 576.32, t: 0.35399 },
  { ik: 590.79, t: 0.32258 },
  { ik: 598.46, t: 0.30193 },
  { ik: 615.23, t: 0.26744 },
  { ik: 630.14, t: 0.24576 },
  { ik: 645.42, t: 0.23003 },
  { ik: 663.19, t: 0.21184 },
  { ik: 674.6, t: 0.18793 },
  { ik: 692.23, t: 0.16769 },
  { ik: 706.41, t: 0.15353 },
  { ik: 727.54, t: 0.13801 },
  { ik: 754.28, t: 0.12678 },
  { ik: 768.89, t: 0.11358 },
  { ik: 784.64, t: 0.10399 },
  { ik: 800.7, t: 0.09556 },
  { ik: 815.6, t: 0.08879 },
  { ik: 835.37, t: 0.07982 },
  { ik: 857.9, t: 0.07412 },
  { ik: 878.0, t: 0.06715 },
  { ik: 899.3, t: 0.05926 },
  { ik: 921.1, t: 0.05506 },
  { ik: 941.7, t: 0.0506 },
  { ik: 957.4, t: 0.04667 },
  { ik: 975.7, t: 0.04436 },
  { ik: 993.3, t: 0.04029 },
  { ik: 1019.3, t: 0.036753 },
  { ik: 1042.1, t: 0.033526 },
  { ik: 1065.4, t: 0.031036 },
  { ik: 1089.2, t: 0.028104 },
  { ik: 1109.7, t: 0.025933 },
  { ik: 1140.6, t: 0.023559 },
  { ik: 1179.0, t: 0.021099 },
  { ik: 1201.0, t: 0.019318 },
  { ik: 1239.2, t: 0.017111 },
  { ik: 1262.1, t: 0.01552 },
  { ik: 1300.0, t: 0.01398 },
  { ik: 1326.6, t: 0.012941 },
  { ik: 1361.3, t: 0.01159 },
  { ik: 1399.4, t: 0.010304 },
  { ik: 1452.4, t: 0.009288 },
  { ik: 1473.5, t: 0.00848 },
  { ik: 1506.5, t: 0.007651 },
  { ik: 1537.3, t: 0.007109 },
  { ik: 1574.6, t: 0.006581 },
  { ik: 1609.8, t: 0.006025 },
  { ik: 1630.7, t: 0.00566 },
  { ik: 1651.9, t: 0.00543 },
  { ik: 1682.6, t: 0.005014 },
  { ik: 1707.6, t: 0.004745 },
  { ik: 1749.0, t: 0.0042965 },
  { ik: 1765.1, t: 0.0040661 },
];

function interpolateDiazed(points: DiazedPoint[], ik: number): number | null {
  if (ik <= 0 || !Number.isFinite(ik) || !points.length) return null;

  // Punkter sorteret i stigende Ik
  const sorted = [...points].sort((a, b) => a.ik - b.ik);

  // Hvis udenfor område → clamp
  if (ik <= sorted[0].ik) return sorted[0].t;
  if (ik >= sorted[sorted.length - 1].ik) return sorted[sorted.length - 1].t;

  // Find segment
  for (let i = 0; i < sorted.length - 1; i++) {
    const p1 = sorted[i];
    const p2 = sorted[i + 1];

    if (ik >= p1.ik && ik <= p2.ik) {
      const logI1 = Math.log10(p1.ik);
      const logI2 = Math.log10(p2.ik);
      const logT1 = Math.log10(p1.t);
      const logT2 = Math.log10(p2.t);
      const logIk = Math.log10(ik);

      const ratio = (logIk - logI1) / (logI2 - logI1);
      const logT = logT1 + ratio * (logT2 - logT1);

      return 10 ** logT;
    }
  }
  return null;
}

export function getDiazedD2D3D4_63ATripTime(ik: number): number | null {
  return interpolateDiazed(DIAZED_D2D3D4_63A_POINTS, ik);
}
