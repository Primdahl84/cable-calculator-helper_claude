// src/lib/neozed_63a.ts
// NEOZED D01/D02/D03 63 A – hårdkodede punkter fra Engauge (Ik [A], t [s])

export type NeozedPoint = {
  ik: number; 
  t: number;  
};

export const NEOZED_63A_POINTS: NeozedPoint[] = [
  { ik: 86.52,  t: 3431.8 },
  { ik: 89.24,  t: 2895.3 },
  { ik: 91.15,  t: 2439.1 },
  { ik: 93.47,  t: 1947.2 },
  { ik: 95.41,  t: 1634.4 },
  { ik: 99.82,  t: 1308.1 },
  { ik: 102.81, t: 1065.7 },
  { ik: 106.51, t: 841.3 },
  { ik: 110.49, t: 680.8 },
  { ik: 113.08, t: 580.3 },
  { ik: 116.03, t: 487.1 },
  { ik: 118.16, t: 451.2 },
  { ik: 121.22, t: 350.26 },
  { ik: 126.32, t: 289.47 },
  { ik: 129.39, t: 241.95 },
  { ik: 133.68, t: 196.7 },
  { ik: 138.59, t: 165.1 },
  { ik: 143.54, t: 133.16 },
  { ik: 147.04, t: 113.93 },
  { ik: 154.01, t: 91.76 },
  { ik: 158.44, t: 75.06 },
  { ik: 165.52, t: 60.77 },
  { ik: 170.72, t: 51.53 },
  { ik: 177.44, t: 42.59 },
  { ik: 183.95, t: 34.838 },
  { ik: 191.19, t: 29.696 },
  { ik: 198.21, t: 24.796 },
  { ik: 206.41, t: 20.537 },
  { ik: 213.02, t: 17.024 },
  { ik: 221.98, t: 14.661 },
  { ik: 229.53, t: 12.369 },
  { ik: 235.01, t: 11.303 },
  { ik: 243.53, t: 9.56 },
  { ik: 251.17, t: 8.233 },
  { ik: 261.06, t: 6.804 },
  { ik: 270.64, t: 6.234 },
  { ik: 278.18, t: 5.463 },
  { ik: 287.88, t: 4.672 },
  { ik: 295.39, t: 4.171 },
  { ik: 308.6,  t: 3.5553 },
  { ik: 320.84, t: 3.086 },
  { ik: 331.67, t: 2.6919 },
  { ik: 344.72, t: 2.3303 },
  { ik: 358.29, t: 1.9863 },
  { ik: 368.58, t: 1.7735 },
  { ik: 370.06, t: 1.6984 },
  { ik: 377.22, t: 1.6081 },
  { ik: 396.13, t: 1.3567 },
  { ik: 410.67, t: 1.1387 },
  { ik: 427.93, t: 0.9557 },
  { ik: 442.5,  t: 0.8316 },
  { ik: 461.1,  t: 0.698 },
  { ik: 478.02, t: 0.5919 },
  { ik: 500.69, t: 0.5098 },
  { ik: 524.43, t: 0.4064 },
  { ik: 536.04, t: 0.37038 },
  { ik: 552.14, t: 0.32311 },
  { ik: 566.54, t: 0.28701 },
  { ik: 585.06, t: 0.25103 },
  { ik: 600.32, t: 0.22528 },
  { ik: 621.77, t: 0.19686 },
  { ik: 629.6,  t: 0.18667 },
  { ik: 656.07, t: 0.16411 },
  { ik: 680.14, t: 0.14133 },
  { ik: 703.29, t: 0.12298 },
  { ik: 717.13, t: 0.11119 },
  { ik: 749.07, t: 0.08889 },
  { ik: 775.6,  t: 0.07656 },
  { ik: 810.3,  t: 0.06426 },
  { ik: 843.2,  t: 0.05365 },
  { ik: 873.1,  t: 0.04633 },
  { ik: 891.2,  t: 0.04073 },
  { ik: 921.5,  t: 0.034718 },
  { ik: 941.9,  t: 0.031158 },
  { ik: 980.3,  t: 0.025355 },
  { ik: 1017.9, t: 0.022232 },
  { ik: 1046.8, t: 0.019497 },
  { ik: 1075.5, t: 0.016965 },
  { ik: 1109.2, t: 0.014686 },
  { ik: 1146.9, t: 0.01318 },
  { ik: 1174.1, t: 0.012236 },
  { ik: 1201.3, t: 0.010453 },
  { ik: 1247,   t: 0.00919 },
  { ik: 1284.5, t: 0.008484 },
  { ik: 1333.3, t: 0.007345 },
  { ik: 1385.8, t: 0.006694 },
  { ik: 1433,   t: 0.005992 },
  { ik: 1482.9, t: 0.005471 },
  { ik: 1544,   t: 0.00474 },
  { ik: 1596.6, t: 0.004309 },
  { ik: 1659.4, t: 0.0038871 },
  { ik: 1731.4, t: 0.003435 },
  { ik: 1801.4, t: 0.0032548 },
  { ik: 1851.3, t: 0.0029054 },
  { ik: 1911.8, t: 0.0026344 },
  { ik: 2024.5, t: 0.0023835 },
  { ik: 2086.6, t: 0.0021828 },
  { ik: 2177.2, t: 0.0019589 },
  { ik: 2292.2, t: 0.0017671 },
  { ik: 2385.5, t: 0.0016315 },
  { ik: 2523.9, t: 0.0014553 },
  { ik: 2607,   t: 0.0013379 },
  { ik: 2716.6, t: 0.0012577 },
  { ik: 2805.4, t: 0.0011884 },
  { ik: 2893.4, t: 0.0011057 },
  { ik: 2961.2, t: 0.001061 },
];

// Log-log interpolation
function interpolateNeozed(points: NeozedPoint[], ik: number): number | null {
  if (!points.length || ik <= 0 || !Number.isFinite(ik)) return null;

  const sorted = [...points].sort((a, b) => a.ik - b.ik);

  if (ik <= sorted[0].ik) return sorted[0].t;
  if (ik >= sorted[sorted.length - 1].ik) return sorted[sorted.length - 1].t;

  for (let i = 0; i < sorted.length - 1; i++) {
    const p1 = sorted[i];
    const p2 = sorted[i + 1];

    if (ik >= p1.ik && ik <= p2.ik) {
      const logI1 = Math.log10(p1.ik);
      const logI2 = Math.log10(p2.ik);
      const logT1 = Math.log10(p1.t);
      const logT2 = Math.log10(p2.t);
      const logIk = Math.log10(ik);

      const ratio = (logIk - logI1) / (logI2 - logI1);
      const logT = logT1 + (logT2 - logT1) * ratio;
      return 10 ** logT;
    }
  }

  return null;
}

export function getNeozed63ATripTime(ik: number): number | null {
  return interpolateNeozed(NEOZED_63A_POINTS, ik);
}
