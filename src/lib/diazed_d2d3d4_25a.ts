// src/lib/diazed_d2d3d4_25a.ts
// DIAZED D2/D3/D4 25 A – hårdkodede punkter fra Engauge (Ik [A], t [s])

export type DiazedPoint = {
  ik: number;
  t: number;
};

export const DIAZED_D2D3D4_25A_POINTS: DiazedPoint[] = [
  { ik: 34.362, t: 3567.5 },
  { ik: 35.278, t: 2977.3 },
  { ik: 36.325, t: 2484.7 },
  { ik: 36.646, t: 2224 },
  { ik: 37.294, t: 2037.6 },
  { ik: 38.066, t: 1604.1 },
  { ik: 38.967, t: 1370.3 },
  { ik: 40.007, t: 1163.8 },
  { ik: 41.194, t: 932.4 },
  { ik: 42.293, t: 747 },
  { ik: 43.932, t: 595 },
  { ik: 45.104, t: 499.4 },
  { ik: 45.768, t: 419.24 },
  { ik: 46.989, t: 343.81 },
  { ik: 47.682, t: 298.89 },
  { ik: 49.385, t: 246.54 },
  { ik: 50.259, t: 214.33 },
  { ik: 51.149, t: 192.96 },
  { ik: 52.207, t: 159.17 },
  { ik: 53.287, t: 144.14 },
  { ik: 54.072, t: 123.85 },
  { ik: 55.515, t: 110.21 },
  { ik: 55.84,  t: 97.5 },
  { ik: 57.162, t: 82.33 },
  { ik: 58.174, t: 71.15 },
  { ik: 59.552, t: 62.95 },
  { ik: 60.429, t: 52.53 },
  { ik: 61.14,  t: 47.02 },
  { ik: 62.405, t: 41.843 },
  { ik: 64.634, t: 35.954 },
  { ik: 65.204, t: 30.893 },
  { ik: 67.336, t: 25.335 },
  { ik: 68.528, t: 22.413 },
  { ik: 70.151, t: 19.485 },
  { ik: 71.812, t: 17.339 },
  { ik: 73.727, t: 14.726 },
  { ik: 74.813, t: 12.876 },
  { ik: 76.585, t: 11.392 },
  { ik: 78.858, t: 9.731 },
  { ik: 80.961, t: 8.66 },
  { ik: 82.154, t: 7.796 },
  { ik: 84.099, t: 6.897 },
  { ik: 86.6,   t: 6.138 },
  { ik: 89.69,  t: 5.689 },
  { ik: 91.01,  t: 4.86 },
  { ik: 93.17,  t: 4.427 },
  { ik: 95.93,  t: 3.7818 },
  { ik: 100.82, t: 3.4048 },
  { ik: 102.61, t: 3.0298 },
  { ik: 105.34, t: 2.7438 },
  { ik: 108.15, t: 2.4847 },
  { ik: 111.36, t: 2.2632 },
  { ik: 116.02, t: 2.0376 },
  { ik: 119.11, t: 1.8345 },
  { ik: 121.58, t: 1.6613 },
  { ik: 124.46, t: 1.5132 },
  { ik: 128.9,  t: 1.3544 },
  { ik: 133.51, t: 1.2194 },
  { ik: 137.07, t: 1.1436 },
  { ik: 141.14, t: 1.0236 },
  { ik: 143.22, t: 0.9324 },
  { ik: 148.33, t: 0.8443 },
  { ik: 152.29, t: 0.7781 },
  { ik: 155.44, t: 0.7298 },
  { ik: 159.58, t: 0.657 },
  { ik: 165.29, t: 0.5915 },
  { ik: 170.69, t: 0.5294 },
  { ik: 175.76, t: 0.4794 },
  { ik: 180.97, t: 0.447 },
  { ik: 184.72, t: 0.40957 },
  { ik: 190.2,  t: 0.3709 },
  { ik: 194.13, t: 0.33982 },
  { ik: 199.9,  t: 0.30953 },
  { ik: 205.23, t: 0.28195 },
  { ik: 208.25, t: 0.26753 },
  { ik: 214.43, t: 0.24511 },
  { ik: 220.15, t: 0.22588 },
  { ik: 226.69, t: 0.20218 },
  { ik: 232.74, t: 0.18851 },
  { ik: 238.25, t: 0.17171 },
  { ik: 242.46, t: 0.16388 },
  { ik: 247.48, t: 0.15103 },
  { ik: 256.32, t: 0.13518 },
  { ik: 263.93, t: 0.12242 },
  { ik: 271.76, t: 0.11281 },
  { ik: 276.57, t: 0.10276 },
  { ik: 282.3,  t: 0.09807 },
  { ik: 289.83, t: 0.08727 },
  { ik: 297.56, t: 0.07949 },
  { ik: 306.39, t: 0.07241 },
  { ik: 313.64, t: 0.06673 },
  { ik: 321.07, t: 0.06222 },
  { ik: 328.67, t: 0.06008 },
  { ik: 338.43, t: 0.05315 },
  { ik: 345.43, t: 0.04927 },
  { ik: 352.57, t: 0.04488 },
  { ik: 359.87, t: 0.041843 },
  { ik: 369.46, t: 0.038114 },
  { ik: 378.21, t: 0.035954 },
  { ik: 390.58, t: 0.032369 },
  { ik: 399.83, t: 0.028973 },
  { ik: 406.91, t: 0.027014 },
  { ik: 418.98, t: 0.025187 },
  { ik: 428.9,  t: 0.023212 },
  { ik: 440.34, t: 0.022024 },
  { ik: 452.09, t: 0.020062 },
  { ik: 462.79, t: 0.018167 },
  { ik: 473.75, t: 0.016548 },
  { ik: 483.55, t: 0.015429 },
  { ik: 496.45, t: 0.014054 },
  { ik: 506.72, t: 0.013181 },
  { ik: 521.76, t: 0.011867 },
  { ik: 535.68, t: 0.011129 },
  { ik: 549.97, t: 0.010316 },
  { ik: 564.64, t: 0.009342 },
  { ik: 578.01, t: 0.008509 },
  { ik: 589.96, t: 0.008074 },
  { ik: 611.04, t: 0.007185 },
  { ik: 627.34, t: 0.006506 },
  { ik: 640.31, t: 0.005927 },
  { ik: 653.56, t: 0.005526 },
  { ik: 674.93, t: 0.00486 },
  { ik: 697.0,  t: 0.004558 },
  { ik: 711.42, t: 0.004401 },
  { ik: 715.59, t: 0.0040798 },
];

// Log-log interpolation
function interpolateDiazed(points: DiazedPoint[], ik: number): number | null {
  if (!points.length || ik <= 0 || !Number.isFinite(ik)) return null;

  const sorted = [...points].sort((a, b) => a.ik - b.ik);

  if (ik <= sorted[0].ik) return sorted[0].t;
  if (ik >= sorted[sorted.length - 1].ik) return sorted[sorted.length - 1].t;

  for (let i = 0; i < sorted.length - 1; i++) {
    const p1 = sorted[i];
    const p2 = sorted[i + 1];

    if (ik >= p1.ik && ik <= p2.ik) {
      const logI1 = Math.log10(p1.ik);
      const logI2 = Math.log10(p2.ik);
      const logT1 = Math.log10(p1.t);
      const logT2 = Math.log10(p2.t);
      const logIk = Math.log10(ik);

      const ratio = (logIk - logI1) / (logI2 - logI1);
      const logT  = logT1 + (logT2 - logT1) * ratio;
      return 10 ** logT;
    }
  }

  return null;
}

export function getDiazedD2D3D4_25ATripTime(ik: number): number | null {
  return interpolateDiazed(DIAZED_D2D3D4_25A_POINTS, ik);
}
