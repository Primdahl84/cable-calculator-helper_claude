// src/lib/diazed_d2d3d4_20a.ts
// DIAZED D2/D3/D4 20 A – hårdkodede punkter fra Engauge (Ik [A], t [s])

export type DiazedPoint = {
  ik: number;
  t: number;
};

export const DIAZED_D2D3D4_20A_POINTS: DiazedPoint[] = [
  { ik: 30.212, t: 3567.5 },
  { ik: 30.934, t: 2955.3 },
  { ik: 31.66,  t: 2524.8 },
  { ik: 32.409, t: 2037.6 },
  { ik: 33.319, t: 1711.2 },
  { ik: 33.944, t: 1382.9 },
  { ik: 35.175, t: 1163.8 },
  { ik: 36.432, t: 879.5 },
  { ik: 37.074, t: 764.5 },
  { ik: 37.594, t: 623.6 },
  { ik: 39.081, t: 502.4 },
  { ik: 40.119, t: 442.7 },
  { ik: 40.872, t: 361.06 },
  { ik: 42.417, t: 286.93 },
  { ik: 43.213, t: 256.3 },
  { ik: 44.024, t: 211 },
  { ik: 45.501, t: 163.88 },
  { ik: 47.199, t: 129.16 },
  { ik: 48.308, t: 104.38 },
  { ik: 49.385, t: 91.44 },
  { ik: 50.839, t: 75.48 },
  { ik: 51.552, t: 62.72 },
  { ik: 52.976, t: 52.23 },
  { ik: 54.002, t: 45.35 },
  { ik: 55.271, t: 37.685 },
  { ik: 56.569, t: 30.175 },
  { ik: 58.167, t: 23.938 },
  { ik: 60.253, t: 19.147 },
  { ik: 61.786, t: 16.224 },
  { ik: 63.531, t: 13.481 },
  { ik: 66.165, t: 10.936 },
  { ik: 67.798, t: 9.394 },
  { ik: 70.151, t: 7.888 },
  { ik: 71.351, t: 7.181 },
  { ik: 73.367, t: 6.25 },
  { ik: 75.791, t: 5.29 },
  { ik: 78.858, t: 4.612 },
  { ik: 80.725, t: 4.2006 },
  { ik: 82.397, t: 3.7208 },
  { ik: 86.31,  t: 3.0917 },
  { ik: 89.58,  t: 2.6907 },
  { ik: 91.81,  t: 2.5138 },
  { ik: 94.27,  t: 2.2566 },
  { ik: 97.84,  t: 1.9458 },
  { ik: 100.82, t: 1.8132 },
  { ik: 103.45, t: 1.6019 },
  { ik: 106.37, t: 1.4334 },
  { ik: 111.94, t: 1.2475 },
  { ik: 116.02, t: 1.0851 },
  { ik: 119.46, t: 0.9625 },
  { ik: 123.41, t: 0.8455 },
  { ik: 128.08, t: 0.7427 },
  { ik: 133.51, t: 0.6494 },
  { ik: 136.68, t: 0.573 },
  { ik: 141.85, t: 0.5127 },
  { ik: 147.22, t: 0.4504 },
  { ik: 153.63, t: 0.38862 },
  { ik: 159.32, t: 0.33799 },
  { ik: 163.06, t: 0.29689 },
  { ik: 167.66, t: 0.26814 },
  { ik: 172.4,  t: 0.24899 },
  { ik: 176.79, t: 0.23257 },
  { ik: 179.76, t: 0.21272 },
  { ik: 188.3,  t: 0.18513 },
  { ik: 194.52, t: 0.16875 },
  { ik: 200.02, t: 0.15241 },
  { ik: 203.44, t: 0.13918 },
  { ik: 209.52, t: 0.12547 },
  { ik: 215.44, t: 0.11437 },
  { ik: 223.59, t: 0.1014 },
  { ik: 229.91, t: 0.0899 },
  { ik: 234.1,  t: 0.08329 },
  { ik: 241.96, t: 0.0747 },
  { ik: 249.95, t: 0.06622 },
  { ik: 259.41, t: 0.05763 },
  { ik: 269.39, t: 0.04985 },
  { ik: 275.55, t: 0.04658 },
  { ik: 283.34, t: 0.041294 },
  { ik: 295.43, t: 0.035607 },
  { ik: 303.77, t: 0.032759 },
  { ik: 309.99, t: 0.030535 },
  { ik: 318.21, t: 0.02722 },
  { ik: 328.72, t: 0.02391 },
  { ik: 342.75, t: 0.021795 },
  { ik: 350.8,  t: 0.019684 },
  { ik: 356.72, t: 0.018274 },
  { ik: 369.19, t: 0.015908 },
  { ik: 381.38, t: 0.014103 },
  { ik: 392.16, t: 0.012737 },
  { ik: 403.23, t: 0.011397 },
  { ik: 410.49, t: 0.010936 },
  { ik: 424.36, t: 0.009919 },
  { ik: 434.33, t: 0.009042 },
  { ik: 440.42, t: 0.008474 },
  { ik: 452.87, t: 0.007583 },
  { ik: 472.37, t: 0.006545 },
  { ik: 483.28, t: 0.005905 },
  { ik: 494.63, t: 0.005383 },
  { ik: 508.61, t: 0.004862 },
  { ik: 530.31, t: 0.00435 },
];

// Log-log interpolation
function interpolateDiazed(points: DiazedPoint[], ik: number): number | null {
  if (!points.length || ik <= 0 || !Number.isFinite(ik)) return null;

  const sorted = [...points].sort((a, b) => a.ik - b.ik);

  if (ik <= sorted[0].ik) return sorted[0].t;
  if (ik >= sorted[sorted.length - 1].ik) return sorted[sorted.length - 1].t;

  for (let i = 0; i < sorted.length - 1; i++) {
    const p1 = sorted[i];
    const p2 = sorted[i + 1];

    if (ik >= p1.ik && ik <= p2.ik) {
      const logI1 = Math.log10(p1.ik);
      const logI2 = Math.log10(p2.ik);
      const logT1 = Math.log10(p1.t);
      const logT2 = Math.log10(p2.t);
      const logIk = Math.log10(ik);

      const ratio = (logIk - logI1) / (logI2 - logI1);
      const logT  = logT1 + (logT2 - logT1) * ratio;

      return 10 ** logT;
    }
  }

  return null;
}

export function getDiazedD2D3D4_20ATripTime(ik: number): number | null {
  return interpolateDiazed(DIAZED_D2D3D4_20A_POINTS, ik);
}
