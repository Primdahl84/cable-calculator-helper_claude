// src/lib/diazed_d2d3d4_80a.ts
// DIAZED D2/D3/D4 80 A – alle punkter hårdkodet fra Engauge
// Kilde: fuld tekstfil fra bruger  :contentReference[oaicite:1]{index=1}

export type DiazedPoint = {
  ik: number;
  t: number;
};

export const DIAZED_D2D3D4_80A_POINTS: DiazedPoint[] = [
  { ik: 110.71, t: 7888 },
  { ik: 111.94, t: 6928 },
  { ik: 114.84, t: 6257 },
  { ik: 116.72, t: 5446 },
  { ik: 118.77, t: 4505 },
  { ik: 120.58, t: 4067.8 },
  { ik: 123.01, t: 3485.2 },
  { ik: 125.43, t: 2996.6 },
  { ik: 128.08, t: 2421.7 },
  { ik: 131.95, t: 1990.6 },
  { ik: 134.48, t: 1626.2 },
  { ik: 137.64, t: 1308.1 },
  { ik: 141.55, t: 1110.7 },
  { ik: 144.85, t: 911.6 },
  { ik: 148.25, t: 743.5 },
  { ik: 149.64, t: 656.1 },
  { ik: 153.63, t: 564.5 },
  { ik: 155.66, t: 483.4 },
  { ik: 158.21, t: 424.58 },
  { ik: 160.43, t: 372.95 },
  { ik: 164.8, t: 322.44 },
  { ik: 167.27, t: 276.01 },
  { ik: 170.41, t: 227.23 },
  { ik: 173.2, t: 206.17 },
  { ik: 176.79, t: 184.16 },
  { ik: 179.34, t: 161.31 },
  { ik: 182.7, t: 138.45 },
  { ik: 186.56, t: 121.05 },
  { ik: 188.3, t: 111.37 },
  { ik: 191.88, t: 102.76 },
  { ik: 196.34, t: 84.74 },
  { ik: 200.02, t: 75.13 },
  { ik: 203.77, t: 66.92 },
  { ik: 208.25, t: 60.08 },
  { ik: 211.48, t: 54.33 },
  { ik: 216.95, t: 48.62 },
  { ik: 223.08, t: 41.921 },
  { ik: 228.32, t: 37.86 },
  { ik: 231.38, t: 34.314 },
  { ik: 237.51, t: 31.025 },
  { ik: 241.96, t: 27.252 },
  { ik: 248.22, t: 23.938 },
  { ik: 254.05, t: 21.922 },
  { ik: 260.1, t: 20.062 },
  { ik: 261.22, t: 19.256 },
  { ik: 268.6, t: 16.993 },
  { ik: 275.76, t: 15.27 },
  { ik: 281.14, t: 13.802 },
  { ik: 288.23, t: 12.521 },
  { ik: 295.49, t: 11.485 },
  { ik: 301.54, t: 10.554 },
  { ik: 306.39, t: 9.731 },
  { ik: 312.86, t: 8.929 },
  { ik: 316.92, t: 8.326 },
  { ik: 322.22, t: 7.751 },
  { ik: 330.33, t: 7.254 },
  { ik: 336.79, t: 6.74 },
  { ik: 341.79, t: 6.228 },
  { ik: 348.47, t: 5.824 },
  { ik: 353.66, t: 5.439 },
  { ik: 358.63, t: 5.028 },
  { ik: 364.5, t: 4.669 },
  { ik: 373.93, t: 4.2458 },
  { ik: 380.94, t: 3.9609 },
  { ik: 388.53, t: 3.6441 },
  { ik: 396.33, t: 3.4048 },
  { ik: 403.7, t: 3.1641 },
  { ik: 412.71, t: 2.8643 },
  { ik: 420.44, t: 2.6413 },
  { ik: 427.33, t: 2.4527 },
  { ik: 435.85, t: 2.2934 },
  { ik: 450.77, t: 2.0376 },
  { ik: 460.29, t: 1.8577 },
  { ik: 469.46, t: 1.6895 },
  { ik: 477.71, t: 1.5761 },
  { ik: 491.2, t: 1.4367 },
  { ik: 501.57, t: 1.2856 },
  { ik: 512.68, t: 1.1913 },
  { ik: 525.41, t: 1.0807 },
  { ik: 533.4, t: 0.9873 },
  { ik: 547.2, t: 0.9 },
  { ik: 555.52, t: 0.8377 },
  { ik: 564.62, t: 0.7833 },
  { ik: 571.87, t: 0.7444 },
  { ik: 583.1, t: 0.7129 },
  { ik: 589.4, t: 0.6374 },
  { ik: 606.05, t: 0.5864 },
  { ik: 617.41, t: 0.5446 },
  { ik: 628.25, t: 0.501 },
  { ik: 637.06, t: 0.4783 },
  { ik: 648.25, t: 0.4411 },
  { ik: 663.19, t: 0.4168 },
  { ik: 672.79, t: 0.38301 },
  { ik: 690.19, t: 0.35075 },
  { ik: 701.5, t: 0.32646 },
  { ik: 714.65, t: 0.29827 },
  { ik: 728.89, t: 0.27761 },
  { ik: 739.11, t: 0.25958 },
  { ik: 754.28, t: 0.24944 },
  { ik: 772.45, t: 0.22177 },
  { ik: 790.59, t: 0.1989 },
  { ik: 811.04, t: 0.18173 },
  { ik: 833.95, t: 0.16337 },
  { ik: 857.9, t: 0.14583 },
  { ik: 876.6, t: 0.1299 },
  { ik: 892.0, t: 0.12091 },
  { ik: 913.0, t: 0.1115 },
  { ik: 931.1, t: 0.10276 },
  { ik: 949.7, t: 0.09372 },
  { ik: 969.8, t: 0.08663 },
  { ik: 992.6, t: 0.07878 },
  { ik: 1015.9, t: 0.07148 },
  { ik: 1039.7, t: 0.06501 },
  { ik: 1059.0, t: 0.0615 },
  { ik: 1079.1, t: 0.05528 },
  { ik: 1109.6, t: 0.05051 },
  { ik: 1137.0, t: 0.04509 },
  { ik: 1162.3, t: 0.041198 },
  { ik: 1181.4, t: 0.038434 },
  { ik: 1204.4, t: 0.035954 },
  { ik: 1227.5, t: 0.032158 },
  { ik: 1256.3, t: 0.029178 },
  { ik: 1282.8, t: 0.026969 },
  { ik: 1314.5, t: 0.024641 },
  { ik: 1339.1, t: 0.022723 },
  { ik: 1369.9, t: 0.021516 },
  { ik: 1393.0, t: 0.019959 },
  { ik: 1432.4, t: 0.01729 },
  { ik: 1460.9, t: 0.015908 },
  { ik: 1502.2, t: 0.014367 },
  { ik: 1532.2, t: 0.013249 },
  { ik: 1558.0, t: 0.012579 },
  { ik: 1577.3, t: 0.01145 },
  { ik: 1612.4, t: 0.010486 },
  { ik: 1650.3, t: 0.009558 },
  { ik: 1687.1, t: 0.008753 },
  { ik: 1724.7, t: 0.008016 },
  { ik: 1772.0, t: 0.007528 },
  { ik: 1806.7, t: 0.006676 },
  { ik: 1853.4, t: 0.005988 },
  { ik: 1892.6, t: 0.005547 },
  { ik: 1928.1, t: 0.00501 },
  { ik: 1991.9, t: 0.004401 },
  { ik: 2033.8, t: 0.0041055 },
];

// Log-log interpolation
function interpolateDiazed(points: DiazedPoint[], ik: number): number | null {
  if (ik <= 0 || !Number.isFinite(ik) || !points.length) return null;

  const sorted = [...points].sort((a, b) => a.ik - b.ik);

  if (ik <= sorted[0].ik) return sorted[0].t;
  if (ik >= sorted[sorted.length - 1].ik) return sorted[sorted.length - 1].t;

  for (let i = 0; i < sorted.length - 1; i++) {
    const p1 = sorted[i];
    const p2 = sorted[i + 1];

    if (ik >= p1.ik && ik <= p2.ik) {
      const logI1 = Math.log10(p1.ik);
      const logI2 = Math.log10(p2.ik);
      const logT1 = Math.log10(p1.t);
      const logT2 = Math.log10(p2.t);
      const logIk = Math.log10(ik);

      const ratio = (logIk - logI1) / (logI2 - logI1);
      const logT = logT1 + ratio * (logT2 - logT1);

      return 10 ** logT;
    }
  }

  return null;
}

export function getDiazedD2D3D4_80ATripTime(ik: number): number | null {
  return interpolateDiazed(DIAZED_D2D3D4_80A_POINTS, ik);
}
