// src/lib/diazed_d2d3d4_50a.ts
// DIAZED D2/D3/D4 50 A – hårdkodede punkter fra Engauge (Ik [A], t [s])

export type DiazedPoint = {
  ik: number;
  t: number;
};

export const DIAZED_D2D3D4_50A_POINTS: DiazedPoint[] = [
  { ik: 72.657, t: 3567.5 },
  { ik: 73.727, t: 3249.6 },
  { ik: 74.813, t: 2841.5 },
  { ik: 77.713, t: 2455.9 },
  { ik: 79.786, t: 2037.6 },
  { ik: 82.636, t: 1730.5 },
  { ik: 84.593, t: 1419.1 },
  { ik: 85.84,  t: 1323.2 },
  { ik: 87.61,  t: 1191.3 },
  { ik: 89.95,  t: 1017.7 },
  { ik: 92.35,  t: 869.3 },
  { ik: 94.54,  t: 747.0 },
  { ik: 96.49,  t: 638.1 },
  { ik: 98.78,  t: 564.5 },
  { ik: 100.82, t: 514.2 },
  { ik: 103.51, t: 431.65 },
  { ik: 105.96, t: 375.25 },
  { ik: 108.79, t: 316.84 },
  { ik: 110.71, t: 293.7 },
  { ik: 114.0,  t: 238.06 },
  { ik: 116.7,  t: 213.08 },
  { ik: 118.77, t: 183.09 },
  { ik: 121.58, t: 167.75 },
  { ik: 123.73, t: 143.3 },
  { ik: 125.19, t: 128.26 },
  { ik: 127.78, t: 113.47 },
  { ik: 131.95, t: 98.07 },
  { ik: 135.87, t: 81.85 },
  { ik: 138.68, t: 69.51 },
  { ik: 141.55, t: 61.14 },
  { ik: 144.9,  t: 56.02 },
  { ik: 149.2,  t: 47.02 },
  { ik: 152.73, t: 39.935 },
  { ik: 156.81, t: 35.124 },
  { ik: 159.12, t: 31.994 },
  { ik: 162.89, t: 28.305 },
  { ik: 167.72, t: 24.606 },
  { ik: 173.21, t: 21.642 },
  { ik: 176.79, t: 18.705 },
  { ik: 182.57, t: 16.072 },
  { ik: 185.8,  t: 14.769 },
  { ik: 188.81, t: 13.61 },
  { ik: 191.88, t: 12.325 },
  { ik: 195.85, t: 11.129 },
  { ik: 201.07, t: 9.731 },
  { ik: 205.23, t: 8.968 },
  { ik: 209.17, t: 8.193 },
  { ik: 214.75, t: 7.081 },
  { ik: 220.15, t: 6.338 },
  { ik: 226.03, t: 5.689 },
  { ik: 230.03, t: 5.167 },
  { ik: 234.44, t: 4.666 },
  { ik: 240.35, t: 4.0325 },
  { ik: 249.3,  t: 3.5261 },
  { ik: 254.08, t: 3.3263 },
  { ik: 258.58, t: 2.8332 },
  { ik: 265.48, t: 2.5359 },
  { ik: 272.16, t: 2.2765 },
  { ik: 278.2,  t: 2.0796 },
  { ik: 285.62, t: 1.9447 },
  { ik: 289.83, t: 1.6906 },
  { ik: 296.25, t: 1.5132 },
  { ik: 302.82, t: 1.3743 },
  { ik: 309.54, t: 1.2555 },
  { ik: 321.07, t: 1.137 },
  { ik: 327.23, t: 0.9942 },
  { ik: 335.47, t: 0.9029 },
  { ik: 340.41, t: 0.8346 },
  { ik: 350.0,  t: 0.7298 },
  { ik: 360.92, t: 0.6647 },
  { ik: 368.39, t: 0.5846 },
  { ik: 374.91, t: 0.5467 },
  { ik: 383.22, t: 0.4951 },
  { ik: 388.87, t: 0.4589 },
  { ik: 394.02, t: 0.42914 },
  { ik: 405.72, t: 0.3978 },
  { ik: 412.9,  t: 0.35919 },
  { ik: 425.16, t: 0.31684 },
  { ik: 436.5,  t: 0.28113 },
  { ik: 446.18, t: 0.25607 },
  { ik: 456.07, t: 0.23257 },
  { ik: 470.3,  t: 0.20396 },
  { ik: 484.26, t: 0.18309 },
  { ik: 493.55, t: 0.16532 },
  { ik: 508.95, t: 0.14711 },
  { ik: 518.72, t: 0.13597 },
  { ik: 533.33, t: 0.11414 },
  { ik: 549.97, t: 0.10519 },
  { ik: 565.46, t: 0.08986 },
  { ik: 583.1,  t: 0.07949 },
  { ik: 595.16, t: 0.07033 },
  { ik: 610.14, t: 0.0624 },
  { ik: 633.79, t: 0.05651 },
  { ik: 645.01, t: 0.05087 },
  { ik: 655.47, t: 0.04648 },
  { ik: 665.13, t: 0.042211 },
  { ik: 679.88, t: 0.038674 },
  { ik: 695.98, t: 0.035227 },
  { ik: 714.55, t: 0.031715 },
  { ik: 726.13, t: 0.029399 },
  { ik: 745.5,  t: 0.027814 },
  { ik: 754.28, t: 0.025114 },
  { ik: 771.01, t: 0.022479 },
  { ik: 786.96, t: 0.020535 },
  { ik: 806.77, t: 0.018114 },
  { ik: 824.66, t: 0.016791 },
  { ik: 838.04, t: 0.016261 },
  { ik: 851.6,  t: 0.014344 },
  { ik: 876.9,  t: 0.012653 },
  { ik: 900.3,  t: 0.01126 },
  { ik: 931.1,  t: 0.010196 },
  { ik: 949.0,  t: 0.009073 },
  { ik: 981.4,  t: 0.007888 },
  { ik: 1009.1, t: 0.006999 },
  { ik: 1024.0, t: 0.006412 },
  { ik: 1046.7, t: 0.005961 },
  { ik: 1063.6, t: 0.00543 },
  { ik: 1084.1, t: 0.00499 },
  { ik: 1104.9, t: 0.004545 },
  { ik: 1131.0, t: 0.0041884 },
];

// Log-log interpolation
function interpolateDiazed(points: DiazedPoint[], ik: number): number | null {
  if (!points.length || ik <= 0 || !Number.isFinite(ik)) return null;

  const sorted = [...points].sort((a, b) => a.ik - b.ik);

  if (ik <= sorted[0].ik) return sorted[0].t;
  if (ik >= sorted[sorted.length - 1].ik) return sorted[sorted.length - 1].t;

  for (let i = 0; i < sorted.length - 1; i++) {
    const p1 = sorted[i];
    const p2 = sorted[i + 1];

    if (ik >= p1.ik && ik <= p2.ik) {
      const logI1 = Math.log10(p1.ik);
      const logI2 = Math.log10(p2.ik);
      const logT1 = Math.log10(p1.t);
      const logT2 = Math.log10(p2.t);
      const logIk = Math.log10(ik);

      const ratio = (logIk - logI1) / (logI2 - logI1);
      const logT = logT1 + (logT2 - logT1) * ratio;

      return 10 ** logT;
    }
  }

  return null;
}

// Offentlig funktion til resten af programmet
export function getDiazedD2D3D4_50ATripTime(ik: number): number | null {
  return interpolateDiazed(DIAZED_D2D3D4_50A_POINTS, ik);
}
