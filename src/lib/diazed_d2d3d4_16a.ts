// src/lib/diazed_d2d3d4_16a.ts
// DIAZED D2/D3/D4 16 A – hårdkodede punkter fra Engauge (Ik [A], t [s])

export type DiazedPoint = {
  ik: number;
  t: number;
};

export const DIAZED_D2D3D4_16A_POINTS: DiazedPoint[] = [
  { ik: 22.55,  t: 3567.5 },
  { ik: 23.28,  t: 2953.7 },
  { ik: 24.066, t: 2386.6 },
  { ik: 24.475, t: 2037.6 },
  { ik: 25.34,  t: 1593 },
  { ik: 25.433, t: 1385.3 },
  { ik: 26.255, t: 1163.8 },
  { ik: 27.278, t: 891.3 },
  { ik: 28.094, t: 664.2 },
  { ik: 29.042, t: 548.7 },
  { ik: 30.021, t: 440.1 },
  { ik: 30.243, t: 366.21 },
  { ik: 31.033, t: 274.93 },
  { ik: 32.08,  t: 233.88 },
  { ik: 33.177, t: 188.51 },
  { ik: 34.154, t: 149.37 },
  { ik: 35.589, t: 107.67 },
  { ik: 36.229, t: 87.34 },
  { ik: 37.294, t: 75.87 },
  { ik: 38.147, t: 60.92 },
  { ik: 39.0,   t: 52.6 },
  { ik: 40.007, t: 43.334 },
  { ik: 41.065, t: 34.592 },
  { ik: 42.138, t: 29.427 },
  { ik: 42.916, t: 24.75 },
  { ik: 44.206, t: 20.079 },
  { ik: 45.361, t: 16.832 },
  { ik: 46.205, t: 14.746 },
  { ik: 47.238, t: 12.544 },
  { ik: 48.831, t: 9.698 },
  { ik: 50.554, t: 8.074 },
  { ik: 51.796, t: 6.967 },
  { ik: 53.346, t: 5.671 },
  { ik: 54.74,  t: 5.192 },
  { ik: 56.168, t: 4.72 },
  { ik: 57.639, t: 4.0144 },
  { ik: 59.583, t: 3.3899 },
  { ik: 61.14,  t: 2.9698 },
  { ik: 63.139, t: 2.7598 },
  { ik: 65.333, t: 2.3473 },
  { ik: 66.303, t: 2.0716 },
  { ik: 69.335, t: 1.7714 },
  { ik: 70.33,  t: 1.6017 },
  { ik: 72.435, t: 1.4135 },
  { ik: 74.877, t: 1.2475 },
  { ik: 77.118, t: 1.1338 },
  { ik: 78.858, t: 1.0601 },
  { ik: 80.902, t: 0.9716 },
  { ik: 83.323, t: 0.8575 },
  { ik: 85.5,   t: 0.7294 },
  { ik: 87.73,  t: 0.6827 },
  { ik: 90.74,  t: 0.6055 },
  { ik: 93.41,  t: 0.5476 },
  { ik: 96.2,   t: 0.4833 },
  { ik: 100.55, t: 0.4234 },
  { ik: 104.42, t: 0.36234 },
  { ik: 107.45, t: 0.33465 },
  { ik: 111.89, t: 0.29752 },
  { ik: 116.09, t: 0.26646 },
  { ik: 119.57, t: 0.2369 },
  { ik: 121.58, t: 0.22196 },
  { ik: 125.9,  t: 0.19425 },
  { ik: 129.67, t: 0.17525 },
  { ik: 133.05, t: 0.16164 },
  { ik: 136.53, t: 0.14371 },
  { ik: 139.9,  t: 0.13283 },
  { ik: 143.76, t: 0.11958 },
  { ik: 146.43, t: 0.11029 },
  { ik: 153.05, t: 0.09878 },
  { ik: 156.48, t: 0.08978 },
  { ik: 160.99, t: 0.07949 },
  { ik: 166.59, t: 0.07148 },
  { ik: 172.21, t: 0.06449 },
  { ik: 179.34, t: 0.05609 },
  { ik: 183.35, t: 0.05097 },
  { ik: 187.44, t: 0.04757 },
  { ik: 192.34, t: 0.043045 },
  { ik: 201.07, t: 0.036803 },
  { ik: 206.29, t: 0.033526 },
  { ik: 210.91, t: 0.03115 },
  { ik: 218.82, t: 0.02729 },
  { ik: 222.89, t: 0.025356 },
  { ik: 231.38, t: 0.022024 },
  { ik: 237.31, t: 0.020189 },
  { ik: 245.31, t: 0.017817 },
  { ik: 253.58, t: 0.016075 },
  { ik: 259.25, t: 0.014718 },
  { ik: 269.39, t: 0.013181 },
  { ik: 278.05, t: 0.011805 },
  { ik: 284.27, t: 0.010808 },
  { ik: 293.86, t: 0.009331 },
  { ik: 301.54, t: 0.008606 },
  { ik: 309.99, t: 0.008074 },
  { ik: 318.67, t: 0.007214 },
  { ik: 329.42, t: 0.006414 },
  { ik: 338.03, t: 0.005829 },
  { ik: 348.14, t: 0.005298 },
  { ik: 356.72, t: 0.004832 },
  { ik: 361.21, t: 0.00454 },
  { ik: 370.65, t: 0.0041874 },
];

// Log-log interpolation
function interpolateDiazed(points: DiazedPoint[], ik: number): number | null {
  if (!points.length || ik <= 0 || !Number.isFinite(ik)) return null;

  const sorted = [...points].sort((a, b) => a.ik - b.ik);

  if (ik <= sorted[0].ik) return sorted[0].t;
  if (ik >= sorted[sorted.length - 1].ik) return sorted[sorted.length - 1].t;

  for (let i = 0; i < sorted.length - 1; i++) {
    const p1 = sorted[i];
    const p2 = sorted[i + 1];

    if (ik >= p1.ik && ik <= p2.ik) {
      const logI1 = Math.log10(p1.ik);
      const logI2 = Math.log10(p2.ik);
      const logT1 = Math.log10(p1.t);
      const logT2 = Math.log10(p2.t);
      const logIk = Math.log10(ik);

      const ratio = (logIk - logI1) / (logI2 - logI1);
      const logT  = logT1 + (logT2 - logT1) * ratio;
      return 10 ** logT;
    }
  }

  return null;
}

export function getDiazedD2D3D4_16ATripTime(ik: number): number | null {
  return interpolateDiazed(DIAZED_D2D3D4_16A_POINTS, ik);
}
